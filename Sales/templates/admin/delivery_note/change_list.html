{% extends "admin/change_list.html" %}
{% load static %}
{% load humanize %}


<!-- Override extrahead to add Chart.js -->
{% block extrahead %}
    {{ block.super }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.4.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const data = {
                datasets:
                    [
                        {
                            label: 'Deliveries',
                            data: {{ chart_data | safe }},
                            backgroundColor: '#1ec95b',
                        }
                    ]
            }

            const ctx = document.getElementById('signups_this_month_chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    layout: {
                        padding: {
                            bottom: 30
                        }
                    },
                    plugins: {
                        title: {
                            text: 'Deliveries this month',
                            display: true
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Deliveries'
                            }
                        }
                    },
                },
            });
        })

    </script>
{% endblock %}

{% block content %}
    <!-- Render our chart -->
    <h2 style="text-align: center">This Month: {{ total_logs | intcomma }}</h2>
    <canvas id="signups_this_month_chart" width="500" height="100"></canvas>

    <!-- Render the rest of the ChangeList view -->
    {{ block.super }}
{% endblock %}
